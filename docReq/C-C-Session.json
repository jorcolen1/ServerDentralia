{ 
    "tipo":"create-checkout-session",
    "req":{
        "email":"jorcolen@gmail.com","uid":"xYjg9OhXiuMmdcJmlCn9AkABYx23","3lrzdULnxdQSOG0btR70":{"id":"3lrzdULnxdQSOG0btR70","name":"Junta de culata","precio":"45","stock":8,"cantidad":1},"IapGSfZ11HaLUlvKF1sn":{"id":"IapGSfZ11HaLUlvKF1sn","name":"Juego parte alta","precio":"40","stock":15,"cantidad":2},"uFqmNIzRXoaoA8U8OM04":{"id":"uFqmNIzRXoaoA8U8OM04","name":"Correa","precio":"20","stock":"20","cantidad":1},"HfiOjyvKMz3y5oODytwN":{"id":"HfiOjyvKMz3y5oODytwN","name":"Tensor de correa","precio":"40","stock":3,"cantidad":1},"scx5FQTF6s2cbMTp2CMG":{"id":"scx5FQTF6s2cbMTp2CMG","name":"Bomba de alimentacion","precio":"80","stock":5,"cantidad":2}}
    },
    "res":{

    }
}






let ItemsMeta=JSON.parse(itemsBuy[0]);
    let UserEmailPedido = ItemsMeta.email;
    let UserUidPedido = ItemsMeta.uid;
    delete ItemsMeta.email;
    delete ItemsMeta.uid;
    let DireccionDefaul=  await traerDireccion(UserUidPedido)
    
    contentHTML =`
    <h1>Informacion de pago Realizado</h1>
    <ul>
      <li>Usuario: ${userEmail}</li>
      <li>Valor: € ${userValor/100}</li>
      <li>Fecha de pago: ${userDate.toLocaleString()}</li>
      <br>
      Envio: 
      <li>Receptor de envío: ${DireccionDefaul.nombre} ${DireccionDefaul.apellidos} </li>
      <li>Dirección de envío: ${DireccionDefaul.calle} ${DireccionDefaul.numero} , ${DireccionDefaul.ciudad} ${DireccionDefaul.cpcode} , ${DireccionDefaul.provincia}</li>
      <li>Indicaciones de envío: ${DireccionDefaul.indicaciones} movil:${DireccionDefaul.telefono}</li>
    </ul>
    `;
    const transporter = nodemailer.createTransport({
      host: 'smtp.gmail.com',//'smtp.ethereal.email',//servidor smtp
      port:465,//587,
      segure: true,//par no ssl
      auth:{
        user:'vestazproducts@gmail.com',
        pass:'hzxdstbjhtemkqgk'
      },
      /*//.......dev
      host:'smtp.ethereal.email',//servidor smtp
      port:587,
      segure: false,//par no ssl
      auth:{
        user:'jenifer.lowe82@ethereal.email',
        pass:'MRVfC1DCT3mY5N5wTk'
      },*/
      tls:{
       // rejectUnauthorized:false
      }
    });
    var mailconten ={
      from:"'Vesta-Z Pedidos'<pedidos@vestaz.es>",
      to: userEmail,
      subject: 'Reporte de pago',
      //text:'hello word',
      html:contentHTML,
    };
    
    const info= await transporter.sendMail(mailconten,(error,info)=>{ 
      if (error){
      res.status(500).send(error.message);
    }else{
      console.log('mail enviado.');
      res.status(200).jsonp(tipoRequest)
    }
    
  
  })


























  Running on port 4242
  los metadatos en stripe: {
    '0': '{"id":"HfiOjyvKMz3y5oODytwN","name":"Tensor de correa","precio":"40","stock":2,"cantidad":1}',
    '1': '{"id":"IapGSfZ11HaLUlvKF1sn","name":"Juego parte alta","precio":"40","stock":9,"cantidad":1}',
    '2': '{"id":"scx5FQTF6s2cbMTp2CMG","name":"Bomba de alimentacion","precio":"80","stock":5,"cantidad":2}',
    '3': '{"id":"UxnZ7TPeCr9JUrfmEsSD","name":"Juego parte baja","precio":"10","stock":7,"cantidad":1}',
    '4': '{"id":"3lrzdULnxdQSOG0btR70","name":"Junta de culata","precio":"45","stock":8,"cantidad":2}',
    '5': '{"id":"4wAarYlSEyepv1VeKuKi","name":"Junta de carter","precio":"35","stock":14,"cantidad":1}',
    uid: 'xYjg9OhXiuMmdcJmlCn9AkABYx23',
    email: 'jorcolen@gmail.com'
  }
  los metadatos en stripe: {
    '0': '{"email":"user2@gmail.com","uid":"rjATAbcSoQTnpy6dCSNR2gXSag93","3xtOLJSylQp9eZfSKODN":{"id":"3xtOLJSylQp9eZfSKODN","name":"RIDEX 82B1792 Disco de freno2","precio":"270","stock":42,"cantidad":1},"4h6OMkfzlYg1P5EOaMWC":{"id":"4h6OMkfzlYg1P5EOaMWC","name":"RIDEX 82B1792 Disco de freno1","precio":"190","stock":121214,"cantidad":1},"HeYUCABGepfSzdxNSEwH":{"id":"HeYUCABGepfSzdxNSEwH","name":"RIDEX 82B1792 Disco de freno","precio":"200","stock":"23","cantidad":1}}'
  }




  los metadatos en stripe: {
    '3xtOLJSylQp9eZfSKODN': {
      id: '3xtOLJSylQp9eZfSKODN',
      name: 'RIDEX 82B1792 Disco de freno2',
      precio: '270',
      stock: 42,
      cantidad: 1
    },
    '4h6OMkfzlYg1P5EOaMWC': {
      id: '4h6OMkfzlYg1P5EOaMWC',
      name: 'RIDEX 82B1792 Disco de freno1',
      precio: '190',
      stock: 121214,
      cantidad: 1
    },
    HeYUCABGepfSzdxNSEwH: {
      id: 'HeYUCABGepfSzdxNSEwH',
      name: 'RIDEX 82B1792 Disco de freno',
      precio: '200',
      stock: '23',
      cantidad: 1
    }
  }



  -->>>>> 5 los metadatos en 33333333: {
    HfiOjyvKMz3y5oODytwN: {
      id: 'HfiOjyvKMz3y5oODytwN',
      name: 'Tensor de correa',
      precio: '40',
      stock: 2,
      cantidad: 1
    },
    IapGSfZ11HaLUlvKF1sn: {
      id: 'IapGSfZ11HaLUlvKF1sn',
      name: 'Juego parte alta',
      precio: '40',
      stock: 9,
      cantidad: 1
    },
    scx5FQTF6s2cbMTp2CMG: {
      id: 'scx5FQTF6s2cbMTp2CMG',
      name: 'Bomba de alimentacion',
      precio: '80',
      stock: 5,
      cantidad: 2
    },
    UxnZ7TPeCr9JUrfmEsSD: {
      id: 'UxnZ7TPeCr9JUrfmEsSD',
      name: 'Juego parte baja',
      precio: '10',
      stock: 7,
      cantidad: 1
    },
    '3lrzdULnxdQSOG0btR70': {
      id: '3lrzdULnxdQSOG0btR70',
      name: 'Junta de culata',
      precio: '45',
      stock: 8,
      cantidad: 2
    },
    '4wAarYlSEyepv1VeKuKi': {
      id: '4wAarYlSEyepv1VeKuKi',
      name: 'Junta de carter',
      precio: '35',
      stock: 14,
      cantidad: 1
    }
  }






